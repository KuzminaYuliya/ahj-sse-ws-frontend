!function(){"use strict";function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}new(function(){function n(e){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),this.gui=e,this.url="wss://ahj-sse-ws-bk.herokuapp.com/",this.user=null}var t,i,s;return t=n,(i=[{key:"init",value:function(){var e=this;this.wsConnect(),this.gui.chatForm.addEventListener("submit",(function(n){return e.sendMessage(n)})),this.gui.formLogin.addEventListener("submit",(function(n){return e.login(n)}))}},{key:"login",value:function(e){e.preventDefault(),this.user=this.gui.loginInput.value,this.ws.send(JSON.stringify({login:this.gui.loginInput.value})),this.gui.loginInput.value="",this.getMessages()}},{key:"sendMessage",value:function(e){e.preventDefault(),this.ws.send(JSON.stringify({message:this.gui.chatInput.value})),this.gui.chatInput.value=""}},{key:"getMessages",value:function(){this.ws.send(JSON.stringify({messagesList:!0}))}},{key:"wsConnect",value:function(){var e=this;this.ws=new WebSocket(this.url);var n=this.ws;n.binaryType="blob",window.addEventListener("beforeunload",(function(){e.ws.send(JSON.stringify({login:e.user}))})),n.addEventListener("open",(function(){console.log("connected")})),n.addEventListener("close",(function(){console.log("connection closed")})),n.addEventListener("message",(function(n){var t=JSON.parse(n.data);t?t[0].msg?t[0].msg&&(e.gui.chatConversation.innerHTML="",t.forEach((function(n){e.gui.drawMessagesList(n.nickname,n.msg,n.date,e.user)}))):(e.gui.usersListContainer.classList.remove("hidden"),e.gui.chat.classList.remove("hidden"),e.gui.usersList.innerHTML="",t.forEach((function(n){e.gui.drawUsersList(n.name)})),e.gui.nameIsOk()):e.gui.changeName(),console.log("response",t)}))}}])&&e(t.prototype,i),s&&e(t,s),n}())(new(function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.chat=document.querySelector(".chat"),this.chatForm=document.querySelector(".chat form"),this.chatConversation=document.querySelector(".conversations"),this.chatInput=this.chatForm.querySelector("input"),this.loginDiv=document.querySelector(".login"),this.formLogin=document.querySelector(".login form"),this.loginInput=this.formLogin.querySelector("input"),this.loginLabel=this.formLogin.querySelector("label"),this.usersListContainer=document.querySelector(".users_list"),this.usersList=document.querySelector(".users_list ul"),this.widget=document.querySelector(".widget")}var t,i,s;return t=e,(i=[{key:"drawUsersList",value:function(e){this.usersList.innerHTML+="\n      <li>".concat(e,"</li>\n    ")}},{key:"changeName",value:function(){this.loginLabel.style.color="red",this.loginInput.classList.add("invalid"),this.loginLabel.innerHTML="Select another name"}},{key:"nameIsOk",value:function(){this.loginDiv.classList.add("hidden"),this.loginLabel.style.color="ingerit",this.loginInput.classList.remove("invalid"),this.loginLabel.innerHTML="Enter your name"}},{key:"drawMessagesList",value:function(e,n,t,i){var s="",o=e;e===i&&(s=" you",o="You"),this.chatConversation.innerHTML+='\n    <div class="message'.concat(s,'">\n    <span>').concat(o,", ").concat(t,"</span>\n    ").concat(n,"\n    </div>\n    ")}}])&&n(t.prototype,i),s&&n(t,s),e}())).init()}();